<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <!-- <link href="https://fonts.googleapis.com/css?family=Roboto|Inconsolata|Work+Sans|Droid+Serif" rel="stylesheet"> -->
    <style>@font-face{font-family:'DroidSerif';font-style:normal;font-weight:400;src:local('DroidSerifRegular'),local('DroidSerif-Regular'),url(https://fonts.gstatic.com/s/droidserif/v8/tDbI2oqRg1oM3QBjjcaDkOr9rAA.ttf)format('truetype');}@font-face{font-family:'Inconsolata';font-style:normal;font-weight:400;src:local('InconsolataRegular'),local('Inconsolata-Regular'),url(https://fonts.gstatic.com/s/inconsolata/v16/QldKNThLqRwH-OJ1UHjlKGlZ5q0.ttf)format('truetype');}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;src:local('Roboto'),local('Roboto-Regular'),url(https://fonts.gstatic.com/s/roboto/v18/KFOmCnqEu92Fr1Mu4mxP.ttf)format('truetype');}@font-face{font-family:'WorkSans';font-style:normal;font-weight:400;src:local('WorkSans'),local('WorkSans-Regular'),url(https://fonts.gstatic.com/s/worksans/v3/QGYsz_wNahGAdqQ43Rh_fKDs.ttf)format('truetype');}</style>
    <!-- <link href="/css/text.css" rel="stylesheet" type="text/css"> -->
    <style>#header h1 { font-size: 120%; display: inline-block; } .sourceCode { overflow-x: scroll; } code, pre { color: #000; background-color: #fff; font-weight: normal; font-family: "Menlo", "Consolas", "Inconsolata", "Anonymous", "Monaco", monospace; font-size: 0.9em; line-height: 1.2em; } p code, li>code { border: 1px solid #DDDDDD; padding: 2px; font-size: 0.8em; } #header h1 a, h2.post-title a, h2.static-title a { color: #000; } ul, ol { margin-left: 2em; } div.highlight, pre { margin-bottom: 1em; } code.has-jax { border: none; background-color: #fff; } .date { font-style: italic; color: #4e4e4e; } body { font: 300 1.1em/1.6em Georgia, "Droid Serif", "Open Sans", "DejaVu Serif", serif; } blockquote { padding-top: 0; } .panel { padding-left: 2em; padding-right: 2em; font-size: 120%; } .panel p { font-weight: bold; font-style: italic; line-height: 1.1em; } footer { text-align: center; } footer span { font-style: italic; } footer { padding-top: 2em; } /* Generated by pandoc. */ table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode, table.sourceCode pre { margin: 0; padding: 0; border: 0; vertical-align: baseline; border: none; } td.lineNumbers { border-right: 1px solid #AAAAAA; text-align: right; color: #AAAAAA; padding-right: 5px; padding-left: 5px; } td.sourceCode { padding-left: 5px; } .sourceCode span.kw { color: #007020; font-weight: bold; } .sourceCode span.dt { color: #902000; } .sourceCode span.dv { color: #40a070; } .sourceCode span.bn { color: #40a070; } .sourceCode span.fl { color: #40a070; } .sourceCode span.ch { color: #4070a0; } .sourceCode span.st { color: #4070a0; } .sourceCode span.co { color: #60a0b0; font-style: italic; } .sourceCode span.ot { color: #007020; } .sourceCode span.al { color: red; font-weight: bold; } .sourceCode span.fu { color: #06287e; } .sourceCode span.re { } .sourceCode span.er { color: red; font-weight: bold; }</style>
    <!-- <link href="/css/aduffy.css" rel="stylesheet" type="text/css"> -->
    <style>/* Modify selection color on WebKit/Mozilla. */ ::-moz-selection { background: antiquewhite; } ::selection { background: antiquewhite; } body { padding-bottom: 30px; }</style>
    
    <title>A new way to deploy Hakyll to Github Pages • aduffy.io</title>
    
  </head>
  <body>
    <div class="row">
        <div id="header" class="large-10 large-offset-1 columns">
            <h1><a href="../">aduffy.io</a>://</h1>
            <a href="../">posts</a>
            /
            <a href="../about.html">about</a>
            /
            <a href="../projects.html">projects</a>
            /
            <a href="../photos.html">photos</a>
            &mdash;
            <span><a class="underline" href="https://github.com/a10y/a10y.github.io/commit/5fb2127
">5fb2127
</a></span>
        </div>
    </div>
    <div class="row">
      <div class="large-10 large-centered columns">
        
        <h1>A new way to deploy Hakyll to Github Pages</h1>
        
        <p class="date">18 Apr 2017</p>

<p>I like Hakyll. It’s cool, it works well, and I should probably be doing more functional programming, so my static blog engine is a good place to start. I used to have my Hakyll blog hosted on a directory on a private DigitalOcean server, but the IRS took me to school this tax season (in retrospect, doing an internship in the UK that started the same week as the Brexit referendum was not the most fiscally responsible choice), so I started cancelling unnecessary services I’d been paying for, and my hosting provider was one of them.</p>
<p>I decided to move over to Github Pages publishing for my site, since it checks all my important boxes—it’s free and you can enforce HTTPS. Github Pages is also served out of a bunch of globally distributed CDNs, so expected latency should be lower than everyone going directly to my US-West region VPS. (<strong>Note</strong>: back when I hosted the blog myself, most of the readers were either bots looking for unsecured mysqladmin instances or other php vulns, almost all of them from China or Estonia: 欢迎朋友 and Tere sõbrad).</p>
<p>It turns out that the GH Pages deployment story for Hakyll blogs is pure fantasy: even Jasper himself recommends a funky technique that requires <code>rsync</code>’ing your built items into the current directory, fiddling with <code>.gitignore</code>s across branches. It’s all very confusing, and I’ve never had any luck getting it to work. After a long time being frustrated with this setup, I took a few minutes today and figured out one that works out better, at least for me.</p>
<p>The trick is that Hakyll generates a <code>_site/</code> directory that includes all the posts and pages it generates. If you setup an ephemeral hidden folder <code>.deploy/</code> in the root of your project, that you ignore with your <code>.gitignore</code>, then you can copy all of the <code>_site/</code> files into <code>.deploy/</code>, and force-push to master from <code>.deploy</code>. This directory can then be deleted if the push succeeds.</p>
<p>If you’re interested, take a look at my <a href="https://github.com/a10y/a10y.github.io/blob/develop/scripts/deploy.sh">deploy script</a> and <a href="https://github.com/a10y/a10y.github.io/blob/develop/.gitignore">.gitignore</a> to see how this works.</p>


<hr />

<div>
    Like this post? Hate this post? <a href="https://twitter.com/intent/tweet?text=@andreweduffy+https://aduffy.io/posts/2017-04-18-hakyll-gh-pages.html+">Give me your feedback!</a>
</div>

      </div>
    </div>

    
  </body>
</html>
